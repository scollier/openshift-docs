<!DOCTYPE html>
<!--[if IE 8]> <html class="ie8"> <![endif]-->
<!--[if IE 9]> <html class="ie9"> <![endif]-->
<!--[if gt IE 9]><!-->
<html>
<!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>OpenShift Enterprise Branch Build | Installation and Configuration | Installing | Deploying a Docker Registry</title>
  <link href="https://assets.openshift.net/content/subdomain.css" rel="stylesheet" type="text/css">
  <link href="../../../scollier-test/_stylesheets/docs.css" rel="stylesheet" />
  <link href="https://assets.openshift.net/content/subdomain/touch-icon-precomposed.png" rel="apple-touch-icon-precomposed" type="image/png">
  <link href="https://assets.openshift.net/content/subdomain/favicon32x32.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="https://assets.openshift.net/content/subdomain/favicon.ico"><![endif]-->
  <!-- or, set /favicon.ico for IE10 win -->
  <meta content="OpenShift" name="application-name">
  <meta content="#000000" name="msapplication-TileColor">
  <meta content="https://assets.openshift.net/content/subdomain/touch-icon-precomposed.png" name="msapplication-TileImage">
  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://assets.openshift.net/content/html5shiv.js" type="text/javascript"></script>
    <script src="https://assets.openshift.net/content/respond.js" type="text/javascript"></script>
    <link href="https://assets.openshift.net/content/vendor/respond-js/respond-proxy.html" id="respond-proxy" rel="respond-proxy">
    <link href="../../../scollier-test/_images/respond.proxy.gif" id="respond-redirect" rel="respond-redirect">
    <script src="../../../scollier-test/_javascripts/respond.proxy.js" type="text/javascript"></script>
  <![endif]-->
  <script src="https://assets.openshift.net/content/modernizr.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/content/subdomain.js" type="text/javascript"></script>
  <script src="../../../scollier-test/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
  <script type="text/javascript" src="https://assets.openshift.net/app/assets/site/tracking.js"></script>
</head>
<body>
  <div class="navbar navbar-default navbar-openshift" role="navigation">
  <div class="navbar-header">
    <div class="dropdown">
      <a href="#" class="dropdown-toggle navbar-menu-toggle" data-toggle="dropdown">
        <span class="navbar-menu-title">MENU</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>
      <ul class="dropdown-menu navbar-menu" role="menu">
        <li class="submenu">
          <a href="#">Overview</a>
          <ul id="submenu-overview" class="dropdown-submenu">
            <li class="submenu-heading">Introduction to OpenShift</li>
            <li>
              <a href="https://www.openshift.com/about/index.html">
                What is OpenShift?
                <span class="submenu-item-desc">Learn about Red Hat's next-generation cloud application platform.</span>
              </a>
            </li>
            <li>
              <a href="https://enterprise.openshift.com/customers">
                Our Customers
                <span class="submenu-item-desc">Discover what companies are using OpenShift to deliver a flexible, scalable cloud applicaiton environtment.</span>
              </a>
            </li>
            <li class="submenu-heading">News</li>
            <li>
              <a href="https://www.openshift.com/about/awards.html">
                Awards
                <span class="submenu-item-desc">Industry recognition and awards.</span>
              </a>
            </li>
            <li>
              <a href="https://blog.openshift.com/">
                OpenShift Blog
                <span class="submenu-item-desc">Keep your finger on the pulse of all things OpenShift.</span>
              </a>
            </li>
            <li>
              <a href="https://blog.openshift.com/category/events/">
                Events
                <span class="submenu-item-desc">OpenShift sponsors and attends a variety of in-person events around the globe.</span>
              </a>
            </li>
            <li>
              <a href="https://www.openshift.com/about/press.html">
                In the Press
                <span class="submenu-item-desc">The latest OpenShift news and press releases.</span>
              </a>
            </li>
            <li class="submenu-divider"></li>
            <li>
              <a href="http://jobs.redhat.com/job-search-results/?keywords=openshift">
                Careers <i class="fa fa-external-link pull-right"></i>
              </a>
            </li>
            <li>
              <a href="https://www.openshift.com/about/logos.html">
                Logos &amp; Media
              </a>
            </li>
          </ul>
        </li>
        <li class="submenu">
          <a href="#">Features</a>
          <ul id="submenu-features" class="dropdown-submenu">
            <li class="submenu-heading">OpenShift Online</li>
            <li>
              <a href="https://www.openshift.com/features/index.html">
                Overview
                <span class="submenu-item-desc">Quickly develop, host, and scale applications in the public cloud with on-demand access.</span>
              </a>
            </li>
            <li>
              <a href="https://www.openshift.com/pricing/index.html">
                Plans &amp; Pricing
                <span class="submenu-item-desc">Host up to 3 apps for free. Upgrade and add production gears, extra storage, and more.</span>
              </a>
            </li>
            <li>
              <a href="https://www.openshift.com/app/account/new">
                Sign up for Free
              </a>
            </li>
            <li class="submenu-heading">OpenShift Dedicated</li>
            <li>
              <a href="https://www.openshift.com/dedicated/index.html">
                Overview
                <span class="submenu-item-desc">Your own private OpenShift cluster, operated by Red Hat.</span>
              </a>
            </li>
            <li class="submenu-heading">OpenShift Enterprise</li>
            <li>
              <a href="https://enterprise.openshift.com/">
                Overview
                <span class="submenu-item-desc">Accelerate application delivery with the speed and consistency that business demands.</span>
              </a>
            </li>
            <li>
              <a href="https://enterprise.openshift.com/resources/index.html">
                Resources
                <span class="submenu-item-desc">Webinars, datasheets, reference architectures, demo videos and more.</span>
              </a>
            </li>
            <li>
              <a href="https://enterprise.openshift.com/trial.html">
                Try it for Free
              </a>
            </li>
            <li class="submenu-divider"></li>
            <li>
              <a href="https://www.openshift.com/showcase/index.html">
                Application Gallery
              </a>
            </li>
          </ul>
        </li>
        <li class="submenu">
          <a href="#">Developers</a>
          <ul id="submenu-developers" class="dropdown-submenu">
            <li>
              <a href="https://developers.openshift.com/en/getting-started-overview.html">
                Getting Started
                <span class="submenu-item-desc">New to OpenShift? Get your first application up and running and learn the basics.</span>
              </a>
            </li>
            <li>
              <a href="https://hub.openshift.com/">
                Hub
                <span class="submenu-item-desc">Find languages, frameworks, databases, and add-on services for OpenShift.</span>
              </a>
            </li>
            <li>
              <a href="https://developers.openshift.com/">
                Developer Portal
                <span class="submenu-item-desc">Learn about building, deploying, and managing your applications.</span>
              </a>
            </li>
            <li>
              <a href="https://docs.openshift.com/">
                Documentation
              </a>
            </li>
            <li class="submenu-divider"></li>
            <li>
              <a href="http://stackoverflow.com/questions/tagged/openshift">
                Stack Overflow
                <span class="submenu-item-desc">A Q&amp;A site for everything development related. Post a question or browse answers on the 'openshift' tag.</span>
              </a>
            </li>
            <li>
              <a href="https://enterprise.openshift.com/resources/index.html#training">
                Training &amp; Certification
                <span class="submenu-item-desc">Red Hat Training's hands-on, task-focused courses and certifications for IT professionals and developers.</span>
              </a>
            </li>
            <li class="submenu-divider"></li>
            <li>
              <a href="https://www.openshift.com/showcase/index.html">
                Application Gallery
                <span class="submenu-item-desc">Our showcase of applications running on OpenShift Online.</span>
              </a>
            </li>
            <li>
              <a href="http://www.openshift.org/#contribute">
                Contribute to OpenShift <i class="fa fa-external-link pull-right"></i>
                <span class="submenu-item-desc">Get in touch with our product team, or become a part of the OpenShift Origin open source project.</span>
              </a>
            </li>
            <li>
              <a href="https://openshift.uservoice.com/">
                Vote on Features
              </a>
            </li>
          </ul>
        </li>
        <li class="submenu">
          <a href="#">Partners</a>
          <ul id="submenu-partners" class="dropdown-submenu">
            <li>
              <a href="https://www.openshift.com/partners/index.html">
                Become a Partner
                <span class="submenu-item-desc">Build on the strength of the world's leading open source company.</span>
              </a>
            </li>
            <li>
              <a href="https://www.openshift.com/partners/index.html">
                Find OpenShift Partners
                <span class="submenu-item-desc">Find qualified partners to help you with your OpenShift projects.</span>
              </a>
            </li>
            <li class="submenu-divider"></li>
            <li>
              <a href="http://commons.openshift.org/">
                OpenShift Commons <i class="fa fa-external-link pull-right"></i>
                <span class="submenu-item-desc">Where users, partners, customers, and contributors come together to collaborate on OpenShift.</span>
              </a>
            </li>
            <li class="submenu-divider"></li>
            <li>
              <a href="https://www.openshift.com/grants/index.html">
                Resource Grants
                <span class="submenu-item-desc">For non-profits, educational institutions, and open source initiatives.</span>
              </a>
            </li>
            <li>
              <a href="https://www.openshift.com/startups/index.html">
                Startup Program
                <span class="submenu-item-desc">Designed to help startups build and scale.</span>
              </a>
            </li>
          </ul>
        </li>
        <li class="submenu">
          <a href="#">Support</a>
          <ul id="submenu-support" class="dropdown-submenu">
            <li>
              <a href="https://access.redhat.com/">
                Red Hat Customer Portal <i class="fa fa-external-link pull-right"></i>
                <span class="submenu-item-desc">Manage support cases, browse Knowledgebase articles, and more.</span>
              </a>
            </li>
            <li>
              <a href="https://docs.openshift.com/">
                Documentation
                <span class="submenu-item-desc">Official product documentation from Red Hat.</span>
              </a>
            </li>
            <li>
              <a href="https://help.openshift.com/">
                Help Center
                <span class="submenu-item-desc">The fastest way to find your available support options.</span>
              </a>
            </li>
            <li>
              <a href="http://stackoverflow.com/questions/tagged/openshift">
                Stack Overflow <i class="fa fa-external-link pull-right"></i>
                <span class="submenu-item-desc">A Q&amp;A site for everything development related. Post a question or browse answers on the 'openshift' tag.</span>
              </a>
            </li>
            <li>
              <a href="https://openshift.redhat.com/app/status">
                System Status <i class="fa fa-external-link pull-right"></i>
              </a>
            </li>
            <li>
              <a href="https://www.openshift.com/about/contact.html">
                Contact Us
              </a>
            </li>
          </ul>
        </li>
        <li class="submenu">
          <a href="#">Connect</a>
          <ul id="submenu-connect" class="dropdown-submenu">
            <li>
              <a href="https://blog.openshift.com/">
                Blog
              </a>
            </li>
            <li>
              <a href="https://blog.openshift.com/category/events/">
                Events &amp; Conferences
              </a>
            </li>
            <li>
              <a href="http://commons.openshift.org/">
                OpenShift Commons <i class="fa fa-external-link pull-right"></i>
                <span class="submenu-item-desc">Where users, partners, customers, and contributors come together to collaborate on OpenShift.</span>
              </a>
            </li>
            <li>
              <a href="https://twitter.com/openshift">
                Twitter <i class="fa fa-external-link pull-right"></i>
              </a>
            </li>
            <li>
              <a href="https://www.facebook.com/openshift">
                Facebook <i class="fa fa-external-link pull-right"></i>
              </a>
            </li>
            <li>
              <a href="https://www.linkedin.com/grp/home?gid=4185734">
                LinkedIn <i class="fa fa-external-link pull-right"></i>
              </a>
            </li>
            <li>
              <a href="https://github.com/openshift/">
                GitHub <i class="fa fa-external-link pull-right"></i>
              </a>
            </li>
            <li>
              <a href="https://plus.google.com/+OpenShift">
                Google+ <i class="fa fa-external-link pull-right"></i>
              </a>
            </li>
            <li>
              <a href="https://www.youtube.com/user/rhopenshift">
                YouTube <i class="fa fa-external-link pull-right"></i>
              </a>
            </li>
          </ul>
        </li>
        <li>
          <a href="https://www.openshift.com/about/contact.html">
            Contact Us
          </a>
        </li>
        <li>
          <form action="https://help.openshift.com/hc/en-us/search" method="get" id="cse-search-form">
            <input name="query" id="cse-search-input" class="navbar-search-query form-control" type="text" placeholder="Search" tabindex="1" autocomplete="off" autofocus>
            <button type="submit" class="btn btn-default fa fa-search" value="Search"></button>
          </form>
        </li>
      </ul>
    </div>
    <a class="navbar-brand" href="/"></a>
  </div>
  <div class="navbar-collapse collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="hidden-xs dropdown"> <a href="#" class="dropdown-toggle nav-log-in" data-toggle="dropdown"> My Account<span class="caret"></span> </a>
        <ul class="dropdown-menu">
          <li><a href="https://openshift.redhat.com/app/console">OpenShift Web Console</a></li>
          <li><a href="https://console.preview.openshift.com/">(Next Gen) Web Console</a></li>
          <li><a href="https://hub.openshift.com/users/auth/github">OpenShift Hub</a></li>
        </ul>
      </li>
      <li class="hidden-xs hidden-sm"><a class="nav-sign-up" href="https://www.openshift.com/app/account/new">Sign up for Free</a></li>
    </ul>
  </div>
</div>
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a href="../../../index.html">Documentation</a>
      </li>
      <li class="hidden-xs active">
        <a href="../../welcome/index.html">OpenShift Enterprise Branch Build</a>
      </li>
      <li class="hidden-xs active">
        <a href="../../install_config/index.html">Installation and Configuration</a>
      </li>
      <li class="hidden-xs active"><a href="../../install_config/install/index.html">Installing</a></li>
      <li class="hidden-xs active">
        Deploying a Docker Registry
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <div class="row-fluid">
          <script>
  (function() {
    var cx = '013769182564158614814:e-dp46b51vk';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search defaultToRefinement="Enterprise Branch Build"></gcse:search>
        </div>
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-right"></span>About
      </a>
      <ul id="topicGroup0" class="collapse  list-unstyled">
            <li><a class="" href="../../welcome/index.html">Welcome</a></li>
            <li><a class="" href="../../welcome/revhistory_all.html">All Revision History</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup1">
        <span id="tgSpan1" class="fa fa-angle-right"></span>Release Notes
      </a>
      <ul id="topicGroup1" class="collapse  list-unstyled">
            <li><a class="" href="../../release_notes/index.html">Overview</a></li>
            <li><a class="" href="../../release_notes/ose_3_2_release_notes.html">OpenShift Enterprise 3.2 Release Notes</a></li>
            <li><a class="" href="../../release_notes/xpaas_release_notes.html">xPaaS Release Notes</a></li>
            <li><a class="" href="../../release_notes/v2_vs_v3.html">Comparing OpenShift Enterprise 2 and OpenShift Enterprise 3</a></li>
            <li><a class="" href="../../release_notes/revhistory_release_notes.html">Revision History</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup2">
        <span id="tgSpan2" class="fa fa-angle-right"></span>Getting Started
      </a>
      <ul id="topicGroup2" class="collapse  list-unstyled">
            <li><a class="" href="../../getting_started/index.html">Overview</a></li>
            <li><a class="" href="../../getting_started/developers_console.html">Web Console Walkthrough</a></li>
            <li><a class="" href="../../getting_started/administrators.html">Setting Up a Cluster</a></li>
            <li><a class="" href="../../getting_started/revhistory_getting_started.html">Revision History</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup3">
        <span id="tgSpan3" class="fa fa-angle-right"></span>Architecture
      </a>
      <ul id="topicGroup3" class="collapse  list-unstyled">
            <li><a class="" href="../../architecture/index.html">Overview</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-1">
                <span id="sgSpan-3-1" class="fa fa-caret-right"></span>&nbsp;Infrastructure Components
              </a>
              <ul id="topicSubGroup-3-1" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../../architecture/infrastructure_components/kubernetes_infrastructure.html">Kubernetes Infrastructure</a></li>
                  <li><a class="" href="../../architecture/infrastructure_components/image_registry.html">Image Registry</a></li>
                  <li><a class="" href="../../architecture/infrastructure_components/web_console.html">Web Console</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-2">
                <span id="sgSpan-3-2" class="fa fa-caret-right"></span>&nbsp;Core Concepts
              </a>
              <ul id="topicSubGroup-3-2" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../../architecture/core_concepts/index.html">Overview</a></li>
                  <li><a class="" href="../../architecture/core_concepts/containers_and_images.html">Containers and Images</a></li>
                  <li><a class="" href="../../architecture/core_concepts/pods_and_services.html">Pods and Services</a></li>
                  <li><a class="" href="../../architecture/core_concepts/projects_and_users.html">Projects and Users</a></li>
                  <li><a class="" href="../../architecture/core_concepts/builds_and_image_streams.html">Builds and Image Streams</a></li>
                  <li><a class="" href="../../architecture/core_concepts/deployments.html">Deployments</a></li>
                  <li><a class="" href="../../architecture/core_concepts/routes.html">Routes</a></li>
                  <li><a class="" href="../../architecture/core_concepts/templates.html">Templates</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-3">
                <span id="sgSpan-3-3" class="fa fa-caret-right"></span>&nbsp;Additional Concepts
              </a>
              <ul id="topicSubGroup-3-3" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../../architecture/additional_concepts/networking.html">Networking</a></li>
                  <li><a class="" href="../../architecture/additional_concepts/sdn.html">OpenShift SDN</a></li>
                  <li><a class="" href="../../architecture/additional_concepts/authentication.html">Authentication</a></li>
                  <li><a class="" href="../../architecture/additional_concepts/authorization.html">Authorization</a></li>
                  <li><a class="" href="../../architecture/additional_concepts/storage.html">Persistent Storage</a></li>
                  <li><a class="" href="../../architecture/additional_concepts/remote_commands.html">Remote Commands</a></li>
                  <li><a class="" href="../../architecture/additional_concepts/port_forwarding.html">Port Forwarding</a></li>
                  <li><a class="" href="../../architecture/additional_concepts/throttling.html">Throttling</a></li>
                  <li><a class="" href="../../architecture/additional_concepts/scm.html">Source Control Management</a></li>
                  <li><a class="" href="../../architecture/additional_concepts/admission_controllers.html">Admission Controllers</a></li>
                  <li><a class="" href="../../architecture/additional_concepts/other_api_objects.html">Other API Objects</a></li>
              </ul>
            </li>
            <li><a class="" href="../../architecture/revhistory_architecture.html">Revision History</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup4">
        <span id="tgSpan4" class="fa fa-angle-down"></span>Installation and Configuration
      </a>
      <ul id="topicGroup4" class="collapse in list-unstyled">
            <li><a class="" href="../../install_config/index.html">Overview</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-4-1">
                <span id="sgSpan-4-1" class="fa fa-caret-down"></span>&nbsp;Installing
              </a>
              <ul id="topicSubGroup-4-1" class="nav-tertiary list-unstyled collapse in">
                  <li><a class="" href="../../install_config/install/index.html">Overview</a></li>
                  <li><a class="" href="../../install_config/install/prerequisites.html">Prerequisites</a></li>
                  <li><a class="" href="../../install_config/install/rpm_vs_containerized.html">RPM vs Containerized</a></li>
                  <li><a class="" href="../../install_config/install/quick_install.html">Quick Installation</a></li>
                  <li><a class="" href="../../install_config/install/advanced_install.html">Advanced Installation</a></li>
                  <li><a class="" href="../../install_config/install/disconnected_install.html">Disconnected Installation</a></li>
                  <li><a class=" active" href="../../install_config/install/docker_registry.html">Deploying a Docker Registry</a></li>
                  <li><a class="" href="../../install_config/install/deploy_router.html">Deploying a Router</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-4-2">
                <span id="sgSpan-4-2" class="fa fa-caret-right"></span>&nbsp;Upgrading
              </a>
              <ul id="topicSubGroup-4-2" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../../install_config/upgrading/index.html">Overview</a></li>
                  <li><a class="" href="../../install_config/upgrading/automated_upgrades.html">Automated Upgrades</a></li>
                  <li><a class="" href="../../install_config/upgrading/manual_upgrades.html">Manual Upgrades</a></li>
              </ul>
            </li>
            <li><a class="" href="../../install_config/downgrade.html">Downgrading</a></li>
            <li><a class="" href="../../install_config/master_node_configuration.html">Master and Node Configuration</a></li>
            <li><a class="" href="../../install_config/imagestreams_templates.html">Loading the Default Image Streams and Templates</a></li>
            <li><a class="" href="../../install_config/certificate_customization.html">Configuring Custom Certificates</a></li>
            <li><a class="" href="../../install_config/configuring_authentication.html">Configuring Authentication and User Agent</a></li>
            <li><a class="" href="../../install_config/syncing_groups_with_ldap.html">Syncing Groups With LDAP</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-4-9">
                <span id="sgSpan-4-9" class="fa fa-caret-right"></span>&nbsp;Advanced LDAP Configuration
              </a>
              <ul id="topicSubGroup-4-9" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../../install_config/advanced_ldap_configuration/index.html">Overview</a></li>
                  <li><a class="" href="../../install_config/advanced_ldap_configuration/sssd_for_ldap_failover.html">Setting up SSSD for LDAP Failover</a></li>
                  <li><a class="" href="../../install_config/advanced_ldap_configuration/configuring_form_based_authentication.html">Configuring Form-Based Authentication</a></li>
                  <li><a class="" href="../../install_config/advanced_ldap_configuration/configuring_extended_ldap_attributes.html">Configuring Extended LDAP Attributes</a></li>
              </ul>
            </li>
            <li><a class="" href="../../install_config/configuring_sdn.html">Configuring the SDN</a></li>
            <li><a class="" href="../../install_config/configuring_aws.html">Configuring for AWS</a></li>
            <li><a class="" href="../../install_config/configuring_openstack.html">Configuring for OpenStack</a></li>
            <li><a class="" href="../../install_config/configuring_gce.html">Configuring for GCE</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-4-14">
                <span id="sgSpan-4-14" class="fa fa-caret-right"></span>&nbsp;Configuring Persistent Storage
              </a>
              <ul id="topicSubGroup-4-14" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../../install_config/persistent_storage/index.html">Overview</a></li>
                  <li><a class="" href="../../install_config/persistent_storage/persistent_storage_nfs.html">Using NFS</a></li>
                  <li><a class="" href="../../install_config/persistent_storage/persistent_storage_glusterfs.html">Using GlusterFS</a></li>
                  <li><a class="" href="../../install_config/persistent_storage/persistent_storage_cinder.html">Using OpenStack Cinder</a></li>
                  <li><a class="" href="../../install_config/persistent_storage/persistent_storage_ceph_rbd.html">Using Ceph RBD</a></li>
                  <li><a class="" href="../../install_config/persistent_storage/persistent_storage_aws.html">Using AWS Elastic Block Store</a></li>
                  <li><a class="" href="../../install_config/persistent_storage/persistent_storage_gce.html">Using GCE Persistent Disk</a></li>
                  <li><a class="" href="../../install_config/persistent_storage/persistent_storage_iscsi.html">Using iSCSI</a></li>
                  <li><a class="" href="../../install_config/persistent_storage/persistent_storage_fibre_channel.html">Using Fibre Channel</a></li>
                  <li><a class="" href="../../install_config/persistent_storage/dynamically_provisioning_pvs.html">Dynamic Provisioning</a></li>
                  <li><a class="" href="../../install_config/persistent_storage/pod_security_context.html">Volume Security</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-4-15">
                <span id="sgSpan-4-15" class="fa fa-caret-right"></span>&nbsp;Persistent Storage Examples
              </a>
              <ul id="topicSubGroup-4-15" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../../install_config/storage_examples/index.html">Overview</a></li>
                  <li><a class="" href="../../install_config/storage_examples/shared_storage.html">Sharing an NFS PV Across Two Pods</a></li>
                  <li><a class="" href="../../install_config/storage_examples/ceph_example.html">Complete Example Using Ceph RBD</a></li>
                  <li><a class="" href="../../install_config/storage_examples/gluster_example.html">Complete Example Using GlusterFS</a></li>
                  <li><a class="" href="../../install_config/storage_examples/privileged_pod_storage.html">Mounting Volumes To Privileged Pods</a></li>
                  <li><a class="" href="../../install_config/storage_examples/gluster_backed_registry.html">Backing Docker Registry with GlusterFS Storage</a></li>
              </ul>
            </li>
            <li><a class="" href="../../install_config/http_proxies.html">Working with HTTP Proxies</a></li>
            <li><a class="" href="../../install_config/build_defaults_overrides.html">Configuring Global Build Defaults and Overrides</a></li>
            <li><a class="" href="../../install_config/configuring_pipeline_execution.html">Configuring Build Pipeline Execution</a></li>
            <li><a class="" href="../../install_config/native_container_routing.html">Native Container Routing</a></li>
            <li><a class="" href="../../install_config/routing_from_edge_lb.html">Routing from Edge Load Balancers</a></li>
            <li><a class="" href="../../install_config/aggregate_logging.html">Aggregating Container Logs</a></li>
            <li><a class="" href="../../install_config/cluster_metrics.html">Enabling Cluster Metrics</a></li>
            <li><a class="" href="../../install_config/web_console_customization.html">Customizing the Web Console</a></li>
            <li><a class="" href="../../install_config/revhistory_install_config.html">Revision History</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup5">
        <span id="tgSpan5" class="fa fa-angle-right"></span>Administrator Solutions
      </a>
      <ul id="topicGroup5" class="collapse  list-unstyled">
            <li><a class="" href="../../admin_solutions/index.html">Overview</a></li>
            <li><a class="" href="../../admin_solutions/master_node_config.html">Master and Node Configuration</a></li>
            <li><a class="" href="../../admin_solutions/user_role_mgmt.html">User and Role Management</a></li>
            <li><a class="" href="../../admin_solutions/authentication.html">Authentication</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup6">
        <span id="tgSpan6" class="fa fa-angle-right"></span>Cluster Administration
      </a>
      <ul id="topicGroup6" class="collapse  list-unstyled">
            <li><a class="" href="../../admin_guide/index.html">Overview</a></li>
            <li><a class="" href="../../admin_guide/manage_nodes.html">Managing Nodes</a></li>
            <li><a class="" href="../../admin_guide/manage_users.html">Managing Users</a></li>
            <li><a class="" href="../../admin_guide/managing_projects.html">Managing Projects</a></li>
            <li><a class="" href="../../admin_guide/service_accounts.html">Configuring Service Accounts</a></li>
            <li><a class="" href="../../admin_guide/manage_authorization_policy.html">Managing Authorization Policies</a></li>
            <li><a class="" href="../../admin_guide/manage_scc.html">Managing Security Context Constraints</a></li>
            <li><a class="" href="../../admin_guide/quota.html">Setting Quotas</a></li>
            <li><a class="" href="../../admin_guide/limits.html">Setting Limit Ranges</a></li>
            <li><a class="" href="../../admin_guide/pruning_resources.html">Pruning Objects</a></li>
            <li><a class="" href="../../admin_guide/garbage_collection.html">Garbage Collection</a></li>
            <li><a class="" href="../../admin_guide/scheduler.html">Scheduler</a></li>
            <li><a class="" href="../../admin_guide/allocating_node_resources.html">Allocating Node Resources</a></li>
            <li><a class="" href="../../admin_guide/overcommit.html">Overcommitting</a></li>
            <li><a class="" href="../../admin_guide/limit_runonce_pod_duration.html">Limit Run-once Pod Duration</a></li>
            <li><a class="" href="../../admin_guide/router.html">Monitoring Routers</a></li>
            <li><a class="" href="../../admin_guide/high_availability.html">High Availability</a></li>
            <li><a class="" href="../../admin_guide/pod_network.html">Managing Pod Networks</a></li>
            <li><a class="" href="../../admin_guide/iptables.html">IPtables</a></li>
            <li><a class="" href="../../admin_guide/securing_builds.html">Securing Builds by Strategy</a></li>
            <li><a class="" href="../../admin_guide/building_dependency_trees.html">Building Dependency Trees</a></li>
            <li><a class="" href="../../admin_guide/sdn_troubleshooting.html">Troubleshooting Networking</a></li>
            <li><a class="" href="../../admin_guide/revhistory_admin_guide.html">Revision History</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup7">
        <span id="tgSpan7" class="fa fa-angle-right"></span>CLI Reference
      </a>
      <ul id="topicGroup7" class="collapse  list-unstyled">
            <li><a class="" href="../../cli_reference/index.html">Overview</a></li>
            <li><a class="" href="../../cli_reference/get_started_cli.html">Get Started with the CLI</a></li>
            <li><a class="" href="../../cli_reference/manage_cli_profiles.html">Managing CLI Profiles</a></li>
            <li><a class="" href="../../cli_reference/basic_cli_operations.html">Developer CLI Operations</a></li>
            <li><a class="" href="../../cli_reference/admin_cli_operations.html">Administrator CLI Operations</a></li>
            <li><a class="" href="../../cli_reference/revhistory_cli_reference.html">Revision History</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup8">
        <span id="tgSpan8" class="fa fa-angle-right"></span>Developer Guide
      </a>
      <ul id="topicGroup8" class="collapse  list-unstyled">
            <li><a class="" href="../../dev_guide/index.html">Overview</a></li>
            <li><a class="" href="../../dev_guide/application_lifecycle.html">Application Life Cycle Examples</a></li>
            <li><a class="" href="../../dev_guide/authentication.html">Authentication</a></li>
            <li><a class="" href="../../dev_guide/projects.html">Projects</a></li>
            <li><a class="" href="../../dev_guide/new_app.html">Creating New Applications</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-8-5">
                <span id="sgSpan-8-5" class="fa fa-caret-right"></span>&nbsp;Application Tutorials
              </a>
              <ul id="topicSubGroup-8-5" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../../dev_guide/app_tutorials/index.html">Overview</a></li>
                  <li><a class="" href="../../dev_guide/app_tutorials/quickstarts.html">Quickstart Templates</a></li>
                  <li><a class="" href="../../dev_guide/app_tutorials/ruby_on_rails.html">Ruby on Rails</a></li>
              </ul>
            </li>
            <li><a class="" href="../../dev_guide/ssh_environment.html">Opening a Remote Shell to Containers</a></li>
            <li><a class="" href="../../dev_guide/templates.html">Templates</a></li>
            <li><a class="" href="../../dev_guide/service_accounts.html">Service Accounts</a></li>
            <li><a class="" href="../../dev_guide/builds.html">Builds</a></li>
            <li><a class="" href="../../dev_guide/managing_images.html">Managing Images</a></li>
            <li><a class="" href="../../dev_guide/compute_resources.html">Quotas and Limit Ranges</a></li>
            <li><a class="" href="../../dev_guide/deployments.html">Deployments</a></li>
            <li><a class="" href="../../dev_guide/routes.html">Routes</a></li>
            <li><a class="" href="../../dev_guide/integrating_external_services.html">Integrating External Services</a></li>
            <li><a class="" href="../../dev_guide/secrets.html">Secrets</a></li>
            <li><a class="" href="../../dev_guide/configmaps.html">ConfigMaps</a></li>
            <li><a class="" href="../../dev_guide/pod_autoscaling.html">Pod Autoscaling</a></li>
            <li><a class="" href="../../dev_guide/volumes.html">Managing Volumes</a></li>
            <li><a class="" href="../../dev_guide/persistent_volumes.html">Using Persistent Volumes</a></li>
            <li><a class="" href="../../dev_guide/executing_remote_commands.html">Executing Remote Commands</a></li>
            <li><a class="" href="../../dev_guide/copy_files_to_container.html">Copying Files</a></li>
            <li><a class="" href="../../dev_guide/port_forwarding.html">Port Forwarding</a></li>
            <li><a class="" href="../../dev_guide/shared_memory.html">Shared Memory</a></li>
            <li><a class="" href="../../dev_guide/application_health.html">Application Health</a></li>
            <li><a class="" href="../../dev_guide/events.html">Events</a></li>
            <li><a class="" href="../../dev_guide/downward_api.html">Downward API</a></li>
            <li><a class="" href="../../dev_guide/environment_variables.html">Managing Environment Variables</a></li>
            <li><a class="" href="../../dev_guide/jobs.html">Jobs</a></li>
            <li><a class="" href="../../dev_guide/revhistory_dev_guide.html">Revision History</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup9">
        <span id="tgSpan9" class="fa fa-angle-right"></span>Creating Images
      </a>
      <ul id="topicGroup9" class="collapse  list-unstyled">
            <li><a class="" href="../../creating_images/index.html">Overview</a></li>
            <li><a class="" href="../../creating_images/guidelines.html">Guidelines</a></li>
            <li><a class="" href="../../creating_images/metadata.html">Image Metadata</a></li>
            <li><a class="" href="../../creating_images/s2i.html">S2I Requirements</a></li>
            <li><a class="" href="../../creating_images/s2i_testing.html">Testing S2I Images</a></li>
            <li><a class="" href="../../creating_images/custom.html">Custom Builder</a></li>
            <li><a class="" href="../../creating_images/revhistory_creating_images.html">Revision History</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup10">
        <span id="tgSpan10" class="fa fa-angle-right"></span>Using Images
      </a>
      <ul id="topicGroup10" class="collapse  list-unstyled">
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-10-0">
                <span id="sgSpan-10-0" class="fa fa-caret-right"></span>&nbsp;Source-to-Image (S2I)
              </a>
              <ul id="topicSubGroup-10-0" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../../using_images/s2i_images/index.html">Overview</a></li>
                  <li><a class="" href="../../using_images/s2i_images/nodejs.html">Node.js</a></li>
                  <li><a class="" href="../../using_images/s2i_images/ruby.html">Ruby</a></li>
                  <li><a class="" href="../../using_images/s2i_images/perl.html">Perl</a></li>
                  <li><a class="" href="../../using_images/s2i_images/php.html">PHP</a></li>
                  <li><a class="" href="../../using_images/s2i_images/python.html">Python</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-10-1">
                <span id="sgSpan-10-1" class="fa fa-caret-right"></span>&nbsp;Database Images
              </a>
              <ul id="topicSubGroup-10-1" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../../using_images/db_images/index.html">Overview</a></li>
                  <li><a class="" href="../../using_images/db_images/mysql.html">MySQL</a></li>
                  <li><a class="" href="../../using_images/db_images/postgresql.html">PostgreSQL</a></li>
                  <li><a class="" href="../../using_images/db_images/mongodb.html">MongoDB</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-10-2">
                <span id="sgSpan-10-2" class="fa fa-caret-right"></span>&nbsp;Docker Images
              </a>
              <ul id="topicSubGroup-10-2" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../../using_images/docker_images/index.html">Overview</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-10-3">
                <span id="sgSpan-10-3" class="fa fa-caret-right"></span>&nbsp;Other Images
              </a>
              <ul id="topicSubGroup-10-3" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../../using_images/other_images/index.html">Overview</a></li>
                  <li><a class="" href="../../using_images/other_images/jenkins.html">Jenkins</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-10-4">
                <span id="sgSpan-10-4" class="fa fa-caret-right"></span>&nbsp;xPaaS Middleware Images
              </a>
              <ul id="topicSubGroup-10-4" class="nav-tertiary list-unstyled collapse">
                  <li><a class="" href="../../using_images/xpaas_images/index.html">Overview</a></li>
              </ul>
            </li>
            <li><a class="" href="../../using_images/revhistory_using_images.html">Revision History</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup11">
        <span id="tgSpan11" class="fa fa-angle-right"></span>REST API Reference
      </a>
      <ul id="topicGroup11" class="collapse  list-unstyled">
            <li><a class="" href="../../rest_api/index.html">Overview</a></li>
            <li><a class="" href="../../rest_api/openshift_v1.html">OpenShift v1</a></li>
            <li><a class="" href="../../rest_api/kubernetes_v1.html">Kubernetes v1</a></li>
            <li><a class="" href="../../rest_api/revhistory_rest_api.html">Revision History</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>Deploying a Docker Registry</h2>
        </div>
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title"></div>
<ul class="sectlevel1">
<li><a href="#overview">Overview</a></li>
<li><a href="#deploy-registry">Deploying the Registry</a>
<ul class="sectlevel2">
<li><a href="#deploying-the-registry-as-a-daemonset">Deploying the Registry as a DaemonSet</a></li>
<li><a href="#registry-compute-resource">Registry Compute Resources</a></li>
<li><a href="#storage-for-the-registry">Storage for the Registry</a></li>
<li><a href="#maintaining-the-registry-ip-address">Maintaining the Registry IP Address</a></li>
</ul>
</li>
<li><a href="#viewing-logs">Viewing Logs</a></li>
<li><a href="#file-storage">File Storage</a></li>
<li><a href="#access">Accessing the Registry Directly</a>
<ul class="sectlevel2">
<li><a href="#access-user-prerequisites">User Prerequisites</a></li>
<li><a href="#access-logging-in-to-the-registry">Logging in to the Registry</a></li>
<li><a href="#access-pushing-and-pulling-images">Pushing and Pulling Images</a></li>
</ul>
</li>
<li><a href="#securing-the-registry">Securing the Registry</a></li>
<li><a href="#advanced-overriding-the-registry-configuration">Advanced: Overriding the Registry Configuration</a>
<ul class="sectlevel2">
<li><a href="#docker-registry-deploying-updated-configuration">Deploying Updated Configuration</a></li>
<li><a href="#registry-configuration-reference">Registry Configuration Reference</a></li>
</ul>
</li>
<li><a href="#whitelisting-docker-registries">Whitelisting Docker Registries</a></li>
<li><a href="#exposing-the-registry">Exposing the Registry</a></li>
<li><a href="#registry-known-issues">Known Issues</a>
<ul class="sectlevel3">
<li><a href="#known-issue-nfs-image-push-fails">Image Push Errors with Scaled Registry Using Shared NFS Volume</a></li>
<li><a href="#pull-of-internally-managed-image-fails-with-code-not-found-code-error">Pull of Internally Managed Image Fails with <code>not found</code> Error</a></li>
<li><a href="#known-issue-s3-image-push-fails">Image Push fails with <code>500 Internal Server Error</code> on S3 storage</a></li>
</ul>
</li>
<li><a href="#registry-whats-next">What&#8217;s Next?</a></li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenShift Enterprise can build
<a href="../../architecture/core_concepts/containers_and_images.html#docker-images">Docker
images</a> from your source code, deploy them, and manage their lifecycle. To
enable this, OpenShift Enterprise provides an internal,
<a href="../../architecture/infrastructure_components/image_registry.html#integrated-openshift-registry">integrated
Docker registry</a> that can be deployed in your OpenShift Enterprise environment to
locally manage images.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploy-registry"><a class="anchor" href="#deploy-registry"></a>Deploying the Registry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To deploy the integrated Docker registry, use the <code>oadm registry</code> command as a
user with cluster administrator privileges. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oadm registry --config=/etc/origin/master/admin.kubeconfig \<i class="conum" data-value="1"></i><b>(1)</b>
    --service-account=registry \<i class="conum" data-value="2"></i><b>(2)</b>
    --images='registry.access.redhat.com/openshift3/ose-${component}:${version}' <i class="conum" data-value="3"></i><b>(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>--config</code> is the path to the
<a href="../../cli_reference/manage_cli_profiles.html#cli-reference-manage-cli-profiles">CLI configuration file</a> for
the <a href="../../architecture/additional_concepts/authorization.html#roles">cluster
administrator</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>--service-account</code> is the service account used to run the registry&#8217;s pod.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Required to pull the correct image for OpenShift Enterprise.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This creates a service and a deployment configuration, both called
<strong>docker-registry</strong>. Once deployed successfully, a pod is created with a name
similar to <strong>docker-registry-1-cpty9</strong>.</p>
</div>
<div class="paragraph">
<p>To see a full list of options that you can specify when creating the registry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oadm registry --help</pre>
</div>
</div>
<div class="sect2">
<h3 id="deploying-the-registry-as-a-daemonset"><a class="anchor" href="#deploying-the-registry-as-a-daemonset"></a>Deploying the Registry as a DaemonSet</h3>
<div class="paragraph">
<p>Use the <code>oadm registry</code> command to deploy the registry as a DaemonSet with the
<code>--daemonset</code> option.</p>
</div>
<div class="paragraph">
<p>Daemonsets ensure that when nodes are created, they contain copies of a
specified pod. When the nodes are removed, the pods are garbage collected.</p>
</div>
<div class="paragraph">
<p>For more information on DaemonSets, see the
<a href="http://kubernetes.io/docs/admin/daemons/">DaemonSet documentation</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using DaemonSets with OpenShift Enterprise is a work in progress, and the only
supported process is creating a registry. Currently, using deployment
configurations to deploy a registry is recommended.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="registry-compute-resource"><a class="anchor" href="#registry-compute-resource"></a>Registry Compute Resources</h3>
<div class="paragraph">
<p>By default, the registry is created with no settings for
<a href="../../dev_guide/compute_resources.html#dev-guide-compute-resources">compute resource requests or
limits</a>. For production, it is highly recommended that the deployment
configuration for the registry be updated to set resource requests and limits
for the registry pod. Otherwise, the registry pod will be considered a
<a href="../../dev_guide/compute_resources.html#quality-of-service-tiers"><strong>BestEffort</strong>
pod</a>.</p>
</div>
<div class="paragraph">
<p>See <a href="../../dev_guide/compute_resources.html#dev-guide-compute-resources">Compute Resources</a> for more
information on configuring requests and limits.</p>
</div>
</div>
<div class="sect2">
<h3 id="storage-for-the-registry"><a class="anchor" href="#storage-for-the-registry"></a>Storage for the Registry</h3>
<div class="paragraph">
<p>The registry stores Docker images and metadata. If you simply deploy a pod with
the registry, it uses an ephemeral volume that is destroyed if the pod exits.
Any images anyone has built or pushed into the registry would disappear.</p>
</div>
<div class="sect3">
<h4 id="registry-production-use"><a class="anchor" href="#registry-production-use"></a>Production Use</h4>
<div class="paragraph">
<p>For production use, attach a remote volume or
<a href="../../install_config/persistent_storage/index.html#install-config-persistent-storage-index">define and use the
persistent storage method of your choice</a>.</p>
</div>
<div class="paragraph">
<p>For example, to use an existing persistent volume claim:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc volume deploymentconfigs/docker-registry --add --name=registry-storage -t pvc \
     --claim-name=&lt;pvc_name&gt; --overwrite</pre>
</div>
</div>
<div class="paragraph">
<p>Or, to attach an existing NFS volume to the registry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc volume deploymentconfigs/docker-registry \
     --add --overwrite --name=registry-storage --mount-path=/registry \
     --source='{"nfs": { "server": "&lt;fqdn&gt;", "path": "/path/to/export"}}'</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>See <a href="#registry-known-issues">Known Issues</a> if using a scaled registry with a
shared NFS volume.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="registry-amazon-s3-storage-back-end"><a class="anchor" href="#registry-amazon-s3-storage-back-end"></a>Use Amazon S3 as a Storage Back-end</h5>
<div class="paragraph">
<p>There is also an option to use Amazon Simple Storage Service storage with the
internal Docker registry. It is a secure cloud storage manageable through
<a href="https://aws.amazon.com/s3/getting-started/">AWS Management Console</a>. To use
it, the registry&#8217;s configuration file must be manually edited and mounted to
the registry pod. However, before you start with the configuration, look at
upstream&#8217;s
<a href="https://docs.docker.com/docker-trusted-registry/configure/config-storage/#amazon-s3">recommended
steps</a>.</p>
</div>
<div class="paragraph">
<p>Take a <a href="#docker-registry-deploying-updated-configuration">default YAML
configuration file</a> as a base and replace the <strong>filesystem</strong> entry in the
<strong>storage</strong> section with <strong>s3</strong> entry such as below. The resulting storage section
may look like this:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span style="color:#606">storage</span>:
  <span style="color:#606">cache</span>:
    <span style="color:#606">layerinfo</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">inmemory</span></span>
  <span style="color:#606">delete</span>:
    <span style="color:#606">enabled</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
  <span style="color:#606">s3</span>:
    <span style="color:#606">accesskey</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">awsaccesskey</span></span>
    <span style="color:#606">secretkey</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">awssecretkey</span></span>
    <span style="color:#606">region</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">us-west-1</span></span>
    <span style="color:#606">regionendpoint</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">http://myobjects.local</span></span>
    <span style="color:#606">bucket</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">bucketname</span></span>
    <span style="color:#606">encrypt</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
    <span style="color:#606">keyid</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mykeyid</span></span>
    <span style="color:#606">secure</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
    <span style="color:#606">v4auth</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false</span></span>
    <span style="color:#606">chunksize</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">5242880</span></span>
    <span style="color:#606">rootdirectory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">/s3/object/name/prefix</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>All of the <strong>s3</strong> configuration options are documented in upstream&#8217;s
<a href="https://docs.docker.com/registry/storage-drivers/s3/">driver reference
documentation</a>.</p>
</div>
<div class="paragraph">
<p><a href="#advanced-overriding-the-registry-configuration">Overriding the registry
configuration</a> will take you through the additional steps on mounting the
configuration file into pod.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When the registry runs on the S3 storage back-end, there are
<a href="#known-issue-s3-image-push-fails">reported issues</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="registry-non-production-use"><a class="anchor" href="#registry-non-production-use"></a>Non-Production Use</h4>
<div class="paragraph">
<p>For non-production use, you can use the <code>--mount-host=&lt;path&gt;</code> option to specify
a directory for the registry to use for persistent storage. The registry volume
is then created as a host-mount at the specified <code>&lt;path&gt;</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>--mount-host</code> option mounts a directory from the node on which the registry
container lives. If you scale up the <strong>docker-registry</strong> deployment configuration,
it is possible that your registry pods and containers will run on different
nodes, which can result in two or more registry containers, each with its own
local storage. This will lead to unpredictable behavior, as subsequent requests
to pull the same image repeatedly may not always succeed, depending on which
container the request ultimately goes to.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>--mount-host</code> option requires that the registry container run in privileged
mode. This is automatically enabled when you specify <code>--mount-host</code>.
However, not all pods are allowed to run
<a href="prerequisites.html#security-warning">privileged containers</a> by default.
If you still want to use this option, create the registry and specify that it use the <strong>registry</strong> service account that was created during installation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oadm registry --service-account=registry \
    --config=/etc/origin/master/admin.kubeconfig \
    --images='registry.access.redhat.com/openshift3/ose-${component}:${version}' \
    --mount-host=&lt;path&gt;</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Docker registry pod runs as user <strong>1001</strong>. This user must be able to write to
the host directory. You may need to change directory ownership to user ID <strong>1001</strong>
with this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo chown 1001:root &lt;path&gt;</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="maintaining-the-registry-ip-address"><a class="anchor" href="#maintaining-the-registry-ip-address"></a>Maintaining the Registry IP Address</h3>
<div class="paragraph">
<p>OpenShift Enterprise refers to the integrated registry by its service IP address,
so if you decide to delete and recreate the <strong>docker-registry</strong> service,
you can ensure a completely transparent transition by arranging to
re-use the old IP address in the new service.
If a new IP address cannot be avoided, you can minimize cluster
disruption by rebooting only the masters.</p>
</div>
<div id="re-using-the-address" class="dlist">
<dl>
<dt class="hdlist1">Re-using the Address</dt>
<dd>
<p>To re-use the IP address, you must save the IP address of the old <strong>docker-registry</strong>
service prior to deleting it, and arrange to replace the newly assigned IP address
with the saved one in the new <strong>docker-registry</strong> service.</p>
</dd>
</dl>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make a note of the <code>ClusterIP</code> for the service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get svc/docker-registry -o yaml | grep clusterIP:</pre>
</div>
</div>
</li>
<li>
<p>Delete the service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc delete svc/docker-registry dc/docker-registry</pre>
</div>
</div>
</li>
<li>
<p>Create the registry definition in <strong><em>registry.yaml</em></strong>, replacing <code>&lt;options&gt;</code>
with, for example, those used in step 3 of the instructions in the
<a href="#registry-non-production-use">Non-Production Use</a> section:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oadm registry &lt;options&gt; -o yaml &gt; registry.yaml</pre>
</div>
</div>
</li>
<li>
<p>Edit <strong><em>registry.yaml</em></strong>, find the <code>Service</code> there,
and change its <code>ClusterIP</code> to the address noted in step 1.</p>
</li>
<li>
<p>Create the registry using the modified <strong><em>registry.yaml</em></strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create -f registry.yaml</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="rebooting-the-masters" class="dlist">
<dl>
<dt class="hdlist1">Rebooting the Masters</dt>
<dd>
<p>If you are unable to re-use the IP address, any operation that uses a <a href="../../architecture/core_concepts/builds_and_image_streams.html#image-streams">pull specification</a>
that includes the old IP address will fail.
To minimize cluster disruption, you must reboot the masters:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart atomic-openshift-master</pre>
</div>
</div>
<div class="paragraph">
<p>This ensures that the old registry URL, which includes the old IP address,
is cleared from the cache.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We recommend against rebooting the entire cluster because that incurs
unnecessary downtime for pods and does not actually clear the cache.
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="viewing-logs"><a class="anchor" href="#viewing-logs"></a>Viewing Logs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To view the logs for the Docker registry, use the <code>oc logs</code> command with the deployment config:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc logs dc/docker-registry
2015-05-01T19:48:36.300593110Z time="2015-05-01T19:48:36Z" level=info msg="version=v2.0.0+unknown"
2015-05-01T19:48:36.303294724Z time="2015-05-01T19:48:36Z" level=info msg="redis not configured" instance.id=9ed6c43d-23ee-453f-9a4b-031fea646002
2015-05-01T19:48:36.303422845Z time="2015-05-01T19:48:36Z" level=info msg="using inmemory layerinfo cache" instance.id=9ed6c43d-23ee-453f-9a4b-031fea646002
2015-05-01T19:48:36.303433991Z time="2015-05-01T19:48:36Z" level=info msg="Using OpenShift Auth handler"
2015-05-01T19:48:36.303439084Z time="2015-05-01T19:48:36Z" level=info msg="listening on :5000" instance.id=9ed6c43d-23ee-453f-9a4b-031fea646002</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="file-storage"><a class="anchor" href="#file-storage"></a>File Storage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tag and image metadata is stored in OpenShift Enterprise, but the registry stores
layer and signature data in a volume that is mounted into the registry container
at <strong><em>/registry</em></strong>. As <code>oc exec</code> does not work on privileged containers, to view a
registry&#8217;s contents you must manually SSH into the node housing the registry
pod&#8217;s container, then run <code>docker exec</code> on the container itself:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>List the current pods to find the pod name of your Docker registry:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># oc get pods</pre>
</div>
</div>
<div class="paragraph">
<p>Then, use <code>oc describe</code> to find the host name for the node running the
container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># oc describe pod &lt;pod_name&gt;</pre>
</div>
</div>
</li>
<li>
<p>Log into the desired node:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ssh node.example.com</pre>
</div>
</div>
</li>
<li>
<p>List the running containers on the node host and identify the container ID for
the Docker registry:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># docker ps | grep ose-docker-registry</pre>
</div>
</div>
</li>
<li>
<p>List the registry contents using the <code>docker exec</code> command:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap"># docker exec -it 4c01db0b339c find /registry
/registry/docker
/registry/docker/registry
/registry/docker/registry/v2
/registry/docker/registry/v2/blobs <i class="conum" data-value="1"></i><b>(1)</b>
/registry/docker/registry/v2/blobs/sha256
/registry/docker/registry/v2/blobs/sha256/ed
/registry/docker/registry/v2/blobs/sha256/ed/ede17b139a271d6b1331ca3d83c648c24f92cece5f89d95ac6c34ce751111810
/registry/docker/registry/v2/blobs/sha256/ed/ede17b139a271d6b1331ca3d83c648c24f92cece5f89d95ac6c34ce751111810/data <i class="conum" data-value="2"></i><b>(2)</b>
/registry/docker/registry/v2/blobs/sha256/a3
/registry/docker/registry/v2/blobs/sha256/a3/a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4
/registry/docker/registry/v2/blobs/sha256/a3/a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4/data
/registry/docker/registry/v2/blobs/sha256/f7
/registry/docker/registry/v2/blobs/sha256/f7/f72a00a23f01987b42cb26f259582bb33502bdb0fcf5011e03c60577c4284845
/registry/docker/registry/v2/blobs/sha256/f7/f72a00a23f01987b42cb26f259582bb33502bdb0fcf5011e03c60577c4284845/data
/registry/docker/registry/v2/repositories <i class="conum" data-value="3"></i><b>(3)</b>
/registry/docker/registry/v2/repositories/p1
/registry/docker/registry/v2/repositories/p1/pause <i class="conum" data-value="4"></i><b>(4)</b>
/registry/docker/registry/v2/repositories/p1/pause/_manifests
/registry/docker/registry/v2/repositories/p1/pause/_manifests/revisions
/registry/docker/registry/v2/repositories/p1/pause/_manifests/revisions/sha256
/registry/docker/registry/v2/repositories/p1/pause/_manifests/revisions/sha256/e9a2ac6418981897b399d3709f1b4a6d2723cd38a4909215ce2752a5c068b1cf
/registry/docker/registry/v2/repositories/p1/pause/_manifests/revisions/sha256/e9a2ac6418981897b399d3709f1b4a6d2723cd38a4909215ce2752a5c068b1cf/signatures <i class="conum" data-value="5"></i><b>(5)</b>
/registry/docker/registry/v2/repositories/p1/pause/_manifests/revisions/sha256/e9a2ac6418981897b399d3709f1b4a6d2723cd38a4909215ce2752a5c068b1cf/signatures/sha256
/registry/docker/registry/v2/repositories/p1/pause/_manifests/revisions/sha256/e9a2ac6418981897b399d3709f1b4a6d2723cd38a4909215ce2752a5c068b1cf/signatures/sha256/ede17b139a271d6b1331ca3d83c648c24f92cece5f89d95ac6c34ce751111810
/registry/docker/registry/v2/repositories/p1/pause/_manifests/revisions/sha256/e9a2ac6418981897b399d3709f1b4a6d2723cd38a4909215ce2752a5c068b1cf/signatures/sha256/ede17b139a271d6b1331ca3d83c648c24f92cece5f89d95ac6c34ce751111810/link <i class="conum" data-value="6"></i><b>(6)</b>
/registry/docker/registry/v2/repositories/p1/pause/_uploads <i class="conum" data-value="7"></i><b>(7)</b>
/registry/docker/registry/v2/repositories/p1/pause/_layers <i class="conum" data-value="8"></i><b>(8)</b>
/registry/docker/registry/v2/repositories/p1/pause/_layers/sha256
/registry/docker/registry/v2/repositories/p1/pause/_layers/sha256/a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4
/registry/docker/registry/v2/repositories/p1/pause/_layers/sha256/a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4/link <i class="conum" data-value="9"></i><b>(9)</b>
/registry/docker/registry/v2/repositories/p1/pause/_layers/sha256/f72a00a23f01987b42cb26f259582bb33502bdb0fcf5011e03c60577c4284845
/registry/docker/registry/v2/repositories/p1/pause/_layers/sha256/f72a00a23f01987b42cb26f259582bb33502bdb0fcf5011e03c60577c4284845/link</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This directory stores all layers and signatures as blobs.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This file contains the blob&#8217;s contents.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This directory stores all the image repositories.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>This directory is for a single image repository <strong>p1/pause</strong>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>This directory contains signatures for a particular image manifest revision.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>This file contains a reference back to a blob (which contains the signature
data).</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>This directory contains any layers that are currently being uploaded and
staged for the given repository.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>This directory contains links to all the layers this repository references.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>This file contains a reference to a specific layer that has been linked into
this repository via an image.</td>
</tr>
</table>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="access"><a class="anchor" href="#access"></a>Accessing the Registry Directly</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For advanced usage, you can access the registry directly to invoke <code>docker</code>
commands. This allows you to push images to or pull them from the integrated
registry directly using operations like <code>docker push</code> or <code>docker pull</code>. To do
so, you must be logged in to the registry using the <code>docker login</code> command. The
operations you can perform depend on your user permissions, as described in the
following sections.</p>
</div>
<div class="sect2">
<h3 id="access-user-prerequisites"><a class="anchor" href="#access-user-prerequisites"></a>User Prerequisites</h3>
<div class="paragraph">
<p>To access the registry directly, the user that you use must satisfy the
following, depending on your intended usage:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For any direct access, you must have a
<a href="../../architecture/core_concepts/projects_and_users.html#users">regular
user</a>, if one does not already exist, for your
preferred <a href="../../install_config/configuring_authentication.html#install-config-configuring-authentication">identity
provider</a>. A regular user can generate an access token required for logging in to
the registry.
<a href="../../architecture/core_concepts/projects_and_users.html#users">System
users</a>, such as <strong>system:admin</strong>, cannot obtain access tokens and, therefore,
cannot access the registry directly.</p>
<div class="paragraph">
<p>For example, if you are using <code>HTPASSWD</code> authentication, you can create one
using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># htpasswd /etc/origin/openshift-htpasswd &lt;user_name&gt;</pre>
</div>
</div>
</li>
<li>
<p>The user must have the <strong>system:registry</strong> role. To add this role:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># oadm policy add-role-to-user system:registry &lt;user_name&gt;</pre>
</div>
</div>
</li>
<li>
<p>Have the <strong>admin</strong> role for the project associated with the Docker operation. For
example, if accessing images in the global <strong>openshift</strong> project:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"> $ oadm policy add-role-to-user admin &lt;user_name&gt; -n openshift</pre>
</div>
</div>
</li>
<li>
<p>For writing or pushing images, for example when using the <code>docker push</code> command,
the user must have the <strong>system:image-builder</strong> role. To add this role:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oadm policy add-role-to-user system:image-builder &lt;user_name&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on user permissions, see
<a href="../../admin_guide/manage_authorization_policy.html#managing-role-bindings">Managing
Role Bindings</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="access-logging-in-to-the-registry"><a class="anchor" href="#access-logging-in-to-the-registry"></a>Logging in to the Registry</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure your user satisfies the <a href="#access-user-prerequisites">prerequisites</a>
for accessing the registry directly.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To log in to the registry directly:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure you are logged in to OpenShift Enterprise as a <strong>regular user</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc login</pre>
</div>
</div>
</li>
<li>
<p>Get your access token:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc whoami -t</pre>
</div>
</div>
</li>
<li>
<p>Log in to the Docker registry:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ docker login -u &lt;username&gt; -e &lt;any_email_address&gt; \
    -p &lt;token_value&gt; &lt;registry_ip&gt;:&lt;port&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="access-pushing-and-pulling-images"><a class="anchor" href="#access-pushing-and-pulling-images"></a>Pushing and Pulling Images</h3>
<div class="paragraph">
<p>After <a href="#access-logging-in-to-the-registry">logging in to the registry</a>, you
can perform <code>docker pull</code> and <code>docker push</code> operations against your registry.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can pull arbitrary images, but if you have the <strong>system:registry</strong> role
added, you can only push images to the registry in your project.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the following examples, we use:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Component</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&lt;registry_ip&gt;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>172.30.124.220</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&lt;port&gt;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&lt;project&gt;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>openshift</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&lt;image&gt;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>busybox</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&lt;tag&gt;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">omitted (defaults to <code>latest</code>)</p></td>
</tr>
</tbody>
</table>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pull an arbitrary image:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ docker pull docker.io/busybox</pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Tag the new image with the form <code>&lt;registry_ip&gt;:&lt;port&gt;/&lt;project&gt;/&lt;image&gt;</code>.
The project name <strong>must</strong> appear in this
<a href="../../architecture/core_concepts/builds_and_image_streams.html#image-streams">pull specification</a>
for OpenShift Enterprise to
correctly place and later access the image in the registry.</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ docker tag docker.io/busybox 172.30.124.220:5000/openshift/busybox</pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Your regular user must have the <strong>system:image-builder</strong> role for the specified
project, which allows the user to write or push an image. Otherwise, the <code>docker
push</code> in the next step will fail. To test, you can
<a href="../../dev_guide/projects.html#create-a-project">create a new project</a> to
push the <strong>busybox</strong> image.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Push the newly-tagged image to your registry:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ docker push 172.30.124.220:5000/openshift/busybox
...
cf2616975b4a: Image successfully pushed
Digest: sha256:3662dd821983bc4326bee12caec61367e7fb6f6a3ee547cbaff98f77403cab55</pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="securing-the-registry"><a class="anchor" href="#securing-the-registry"></a>Securing the Registry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Optionally, you can secure the registry so that it serves traffic via TLS:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#deploy-registry">Deploy the registry</a>.</p>
</li>
<li>
<p>Fetch the service IP and port of the registry:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get svc/docker-registry
NAME              LABELS                                    SELECTOR                  IP(S)            PORT(S)
docker-registry   docker-registry=default                   docker-registry=default   172.30.124.220   5000/TCP</pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>You can use an existing server certificate, or create a key and server
certificate valid for specified IPs and host names, signed by a specified CA. To
create a server certificate for the registry service IP and the
<strong>docker-registry.default.svc.cluster.local</strong> host name:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oadm ca create-server-cert \
    --signer-cert=/etc/origin/master/ca.crt \
    --signer-key=/etc/origin/master/ca.key \
    --signer-serial=/etc/origin/master/ca.serial.txt \
    --hostnames='docker-registry.default.svc.cluster.local,172.30.124.220' \
    --cert=/etc/secrets/registry.crt \
    --key=/etc/secrets/registry.key</pre>
</div>
</div>
</li>
<li>
<p>Create the secret for the registry certificates:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc secrets new registry-secret \
    /etc/secrets/registry.crt \
    /etc/secrets/registry.key</pre>
</div>
</div>
</li>
<li>
<p>Add the secret to the registry pod&#8217;s service accounts (including the <strong>default</strong>
service account):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc secrets add serviceaccounts/registry secrets/registry-secret
$ oc secrets add serviceaccounts/default  secrets/registry-secret</pre>
</div>
</div>
</li>
<li>
<p>Add the secret volume to the registry deployment configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc volume dc/docker-registry --add --type=secret \
    --secret-name=registry-secret -m /etc/secrets</pre>
</div>
</div>
</li>
<li>
<p>Enable TLS by adding the following environment variables to the registry
deployment configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc env dc/docker-registry \
    REGISTRY_HTTP_TLS_CERTIFICATE=/etc/secrets/registry.crt \
    REGISTRY_HTTP_TLS_KEY=/etc/secrets/registry.key</pre>
</div>
</div>
<div class="paragraph">
<p>See more details on
<a href="https://github.com/docker/distribution/blob/master/docs/configuration.md#override-configuration-options">overriding
registry options</a>.</p>
</div>
</li>
<li>
<p>Update the scheme used for the registry&#8217;s liveness probe from HTTP to HTTPS:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc patch dc/docker-registry --api-version=v1 -p '{"spec": {"template": {"spec": {"containers":[{
    "name":"registry",
    "livenessProbe":  {"httpGet": {"scheme":"HTTPS"}}
  }]}}}}'</pre>
</div>
</div>
</li>
<li>
<p>If your registry was initially deployed on OpenShift Enterprise
3.2
or later, update the scheme used for the registry&#8217;s readiness probe from HTTP to HTTPS:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc patch dc/docker-registry --api-version=v1 -p '{"spec": {"template": {"spec": {"containers":[{
    "name":"registry",
    "readinessProbe":  {"httpGet": {"scheme":"HTTPS"}}
  }]}}}}'</pre>
</div>
</div>
</li>
<li>
<p>Validate the registry is running in TLS mode. Wait until the latest <strong>docker-registry</strong>
deployment completes and verify the Docker logs for the registry container. You should
find an entry for <code>listening on :5000, tls</code>.</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc logs dc/docker-registry | grep tls
time="2015-05-27T05:05:53Z" level=info msg="listening on :5000, tls" instance.id=deeba528-c478-41f5-b751-dc48e4935fc2</pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Copy the CA certificate to the Docker certificates directory. This must be
done on all nodes in the cluster:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ dcertsdir=/etc/docker/certs.d
$ destdir_addr=$dcertsdir/172.30.124.220:5000
$ destdir_name=$dcertsdir/docker-registry.default.svc.cluster.local:5000

$ sudo mkdir -p $destdir_addr $destdir_name
$ sudo cp ca.crt $destdir_addr    <i class="conum" data-value="1"></i><b>(1)</b>
$ sudo cp ca.crt $destdir_name</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <strong><em>ca.crt</em></strong> file is a copy
of <strong><em>/etc/origin/master/ca.crt</em></strong> on the master.</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Remove the <code>--insecure-registry</code> option only for this particular registry in
the <strong><em>/etc/sysconfig/docker</em></strong> file. Then, reload the daemon and restart the
<strong>docker</strong> service to reflect this configuration change:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo systemctl daemon-reload
$ sudo systemctl restart docker</pre>
</div>
</div>
</li>
<li>
<p>Validate the <code>docker</code> client connection. Running
<a href="https://docs.docker.com/reference/commandline/push/"><code>docker push</code></a>
to the registry or
<a href="https://docs.docker.com/reference/commandline/pull/"><code>docker pull</code></a> from the registry should succeed.  Make sure you have
<a href="#access">logged into the registry</a>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ docker tag|push &lt;registry/image&gt; &lt;internal_registry/project/image&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ docker pull busybox
$ docker tag docker.io/busybox 172.30.124.220:5000/openshift/busybox
$ docker push 172.30.124.220:5000/openshift/busybox
...
cf2616975b4a: Image successfully pushed
Digest: sha256:3662dd821983bc4326bee12caec61367e7fb6f6a3ee547cbaff98f77403cab55</pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advanced-overriding-the-registry-configuration"><a class="anchor" href="#advanced-overriding-the-registry-configuration"></a>Advanced: Overriding the Registry Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can override the integrated registry&#8217;s default configuration, found by
default at <strong><em>/config.yml</em></strong> in a running registry&#8217;s container, with your own
<a href="#registry-configuration-reference">custom configuration</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Upstream configuration options in this file may also be overridden using
environment variables. The
<a href="#docker-registry-configuration-reference-middleware">middleware section</a> is
an exception as there are just a few options that can be overridden using
environment variables.
<a href="https://docs.docker.com/registry/configuration/#override-specific-configuration-options">Learn
how to override specific configuration options</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="docker-registry-deploying-updated-configuration"><a class="anchor" href="#docker-registry-deploying-updated-configuration"></a>Deploying Updated Configuration</h3>
<div class="paragraph">
<p>To enable management of the registry configuration file directly, mount the
configuration file as a <a href="../../dev_guide/secrets.html#dev-guide-secrets">secret volume</a>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#deploy-registry">Deploy the registry</a>.</p>
</li>
<li>
<p>Edit the registry configuration file locally as needed. The initial YAML file
deployed on the registry is provided below.
<a href="#registry-configuration-reference">Review supported options</a>.</p>
<div class="exampleblock">
<div class="title">Example 1. Registry configuration file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span style="color:#606">version</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">0.1</span></span>
<span style="color:#606">log</span>:
  <span style="color:#606">level</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">debug</span></span>
<span style="color:#606">http</span>:
  <span style="color:#606">addr</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">:5000</span></span>
<span style="color:#606">storage</span>:
  <span style="color:#606">cache</span>:
    <span style="color:#606">blobdescriptor</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">inmemory</span></span>
  <span style="color:#606">filesystem</span>:
    <span style="color:#606">rootdirectory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">/registry</span></span>
  <span style="color:#606">delete</span>:
    <span style="color:#606">enabled</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
<span style="color:#606">auth</span>:
  <span style="color:#606">openshift</span>:
    <span style="color:#606">realm</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">openshift</span></span>
<span style="color:#606">middleware</span>:
  <span style="color:#606">registry</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: openshift</span></span>
  <span style="color:#606">repository</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: openshift</span></span>
      <span style="color:#606">options</span>:
        <span style="color:#606">acceptschema2</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false</span></span>
        <span style="color:#606">pullthrough</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
        <span style="color:#606">enforcequota</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false</span></span>
        <span style="color:#606">projectcachettl</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1m</span></span>
  <span style="color:#606">storage</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: openshift</span></span></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Create a new secret called <strong>registry-config</strong> from your custom registry
configuration file you edited locally:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc secrets new registry-config config.yml=&lt;/path/to/custom/registry/config.yml&gt;</pre>
</div>
</div>
</li>
<li>
<p>Add the <strong>registry-config</strong> secret as a volume to the registry&#8217;s deployment
configuration to mount the custom configuration file at
<strong><em>/etc/docker/registry/</em></strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc volume dc/docker-registry --add --type=secret \
    --secret-name=registry-config -m /etc/docker/registry/</pre>
</div>
</div>
</li>
<li>
<p>Update the registry to reference the configuration path from the previous step
by adding the following environment variable to the registry&#8217;s deployment
configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc env dc/docker-registry \
    REGISTRY_CONFIGURATION_PATH=/etc/docker/registry/config.yml</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This may be performed as an iterative process to achieve the desired
configuration. For example, during troubleshooting, the configuration may be
temporarily updated to put it in <strong>debug</strong> mode.</p>
</div>
<div class="paragraph">
<p>To update an existing configuration:</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This procedure will overwrite the currently deployed registry configuration.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Edit the local registry configuration file, <strong><em>config.yml</em></strong>.</p>
</li>
<li>
<p>Delete the <strong>registry-config</strong> secret:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc delete secret registry-config</pre>
</div>
</div>
</li>
<li>
<p>Recreate the secret to reference the updated configuration file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc secrets new registry-config config.yml=&lt;/path/to/custom/registry/config.yml&gt;</pre>
</div>
</div>
</li>
<li>
<p>Redeploy the registry to read the updated configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc deploy docker-registry --latest</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Maintain configuration files in a source control repository.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>tag::registry-configuration-reference[]</p>
</div>
</div>
<div class="sect2">
<h3 id="registry-configuration-reference"><a class="anchor" href="#registry-configuration-reference"></a>Registry Configuration Reference</h3>
<div class="paragraph">
<p>There are many configuration options available in the upstream
<a href="https://github.com/docker/distribution">docker distribution</a>
library. Not all <a href="https://docs.docker.com/registry/configuration/">configuration options</a>
are supported or enabled. Use this section as a reference.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Upstream configuration options in this file may also be overridden using
environment variables. However, the
<a href="#docker-registry-configuration-reference-middleware">middleware section</a> may
<strong>not</strong> be overridden using environment variables.
<a href="https://docs.docker.com/registry/configuration/#override-specific-configuration-options">Learn
how to override specific configuration options</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="docker-registry-configuration-reference-log"><a class="anchor" href="#docker-registry-configuration-reference-log"></a>Log</h4>
<div class="paragraph">
<p><a href="https://docs.docker.com/registry/configuration/#log">Upstream options</a> are supported.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span style="color:#606">log</span>:
  <span style="color:#606">level</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">debug</span></span>
  <span style="color:#606">formatter</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">text</span></span>
  <span style="color:#606">fields</span>:
    <span style="color:#606">service</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">registry</span></span>
    <span style="color:#606">environment</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">staging</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="docker-registry-configuration-reference-hooks"><a class="anchor" href="#docker-registry-configuration-reference-hooks"></a>Hooks</h4>
<div class="paragraph">
<p>Mail hooks are not supported.</p>
</div>
</div>
<div class="sect3">
<h4 id="docker-registry-configuration-reference-storage"><a class="anchor" href="#docker-registry-configuration-reference-storage"></a>Storage</h4>
<div class="paragraph">
<p>The following <a href="https://docs.docker.com/registry/configuration/#storage">storage drivers</a>
are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.docker.com/registry/storage-drivers/filesystem">Filesystem</a></p>
</li>
<li>
<p><a href="https://docs.docker.com/registry/storage-drivers/azure/">Microsoft Azure</a></p>
</li>
<li>
<p><a href="https://docs.docker.com/registry/storage-drivers/s3/">S3</a></p>
<div class="paragraph">
<p><a href="#docker-registry-configuration-reference-middleware">Learn more about CloudFront configuration</a>.</p>
</div>
</li>
<li>
<p><a href="https://docs.docker.com/registry/storage-drivers/swift/">OpenStack Swift</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://docs.docker.com/registry/configuration/#maintenance">General registry storage configuration options</a> are supported.</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. General Storage Configuration Options</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span style="color:#606">storage</span>:
  <span style="color:#606">delete</span>:
    <span style="color:#606">enabled</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
  <span style="color:#606">redirect</span>:
    <span style="color:#606">disable</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false</span></span>
  <span style="color:#606">cache</span>:
    <span style="color:#606">blobdescriptor</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">inmemory</span></span>
  <span style="color:#606">maintenance</span>:
    <span style="color:#606">uploadpurging</span>:
      <span style="color:#606">enabled</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
      <span style="color:#606">age</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">168h</span></span>
      <span style="color:#606">interval</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">24h</span></span>
      <span style="color:#606">dryrun</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false</span></span>
    <span style="color:#606">readonly</span>:
      <span style="color:#606">enabled</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="docker-registry-configuration-reference-auth"><a class="anchor" href="#docker-registry-configuration-reference-auth"></a>Auth</h4>
<div class="paragraph">
<p>Auth options should not be altered. The <strong>openshift</strong> extension is the only
supported option.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span style="color:#606">auth</span>:
  <span style="color:#606">openshift</span>:
    <span style="color:#606">realm</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">openshift</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="docker-registry-configuration-reference-middleware"><a class="anchor" href="#docker-registry-configuration-reference-middleware"></a>Middleware</h4>
<div class="paragraph">
<p>The <strong>repository</strong> middleware extension allows to configure OpenShift Enterprise
middleware responsible for interaction with OpenShift Enterprise and image proxying.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span style="color:#606">middleware</span>:
  <span style="color:#606">registry</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: openshift </span></span><i class="conum" data-value="1"></i><b>(1)</b>
  <span style="color:#606">repository</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: openshift </span></span><i class="conum" data-value="1"></i><b>(1)</b>
      <span style="color:#606">options</span>:
        <span style="color:#606">acceptschema2</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false </span></span><i class="conum" data-value="2"></i><b>(2)</b>
        <span style="color:#606">pullthrough</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true </span></span><i class="conum" data-value="3"></i><b>(3)</b>
        <span style="color:#606">enforcequota</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false </span></span><i class="conum" data-value="4"></i><b>(4)</b>
        <span style="color:#606">projectcachettl</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1m </span></span><i class="conum" data-value="5"></i><b>(5)</b>
  <span style="color:#606">storage</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: openshift </span></span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>These entries are mandatory. Their presence ensures required components get loaded. These values shouldn&#8217;t be changed.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Allow to store
<a href="https://github.com/docker/distribution/blob/master/docs/spec/manifest-v2-2.md#image-manifest-version-2-schema-2">manifest
schema v2</a> during a push to the registry. See <a href="#middleware-repository-acceptschema2">below</a> for more details.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Let the registry act as a proxy for remote blobs. See <a href="#middleware-repository-pullthrough">below</a> for more details.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Prevent blob uploads exceeding size limit defined in targeted project.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>An expiration timeout for limits cached in the registry. The lower the
value, the less time will it take for the limit changes to propagate to the
registry. However, the registry will query limits from the server more
frequently and, as a consequence, pushes will be slower.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://docs.docker.com/registry/configuration/#cloudfront"><strong>CloudFront</strong>
middleware extension</a> can be added to support AWS, CloudFront CDN storage
provider.</p>
</div>
<div class="paragraph">
<p>The <strong>middleware</strong> section may not be overridden using environment variables.
There are a few exceptions, however. For example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span style="color:#606">middleware</span>:
  <span style="color:#606">repository</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: openshift</span></span>
      <span style="color:#606">options</span>:
        <span style="color:#606">acceptschema2</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false </span></span><i class="conum" data-value="1"></i><b>(1)</b>
        <span style="color:#606">enforcequota</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false </span></span><i class="conum" data-value="2"></i><b>(2)</b>
        <span style="color:#606">projectcachettl</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1m </span></span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A configuration option that can be overridden by the boolean environment variable <code><strong>REGISTRY_MIDDLEWARE_REPOSITORY_OPENSHIFT_ACCEPTSCHEMA2</strong></code>, which allows for the ability to accept manifest schema v2 on manifest put requests.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A configuration option that can be overridden by the boolean environment variable <code><strong>REGISTRY_MIDDLEWARE_REPOSITORY_OPENSHIFT_ENFORCEQUOTA</strong></code>, which allows the ability to turn quota enforcement on or off. By default, quota enforcement is off. It overrides OpenShift Enterprise middleware configuration option. Recognized values are <strong>true</strong> and <strong>false</strong>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A configuration option that can be overridden by the environment variable <code><strong>REGISTRY_MIDDLEWARE_REPOSITORY_OPENSHIFT_PROJECTCACHETTL</strong></code>, specifying an eviction timeout for project quota objects. It takes a valid time duration string (for example, <strong>2m</strong>). If empty, you get the default timeout. If zero (<strong>0m</strong>), caching is disabled.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="middleware-repository-pullthrough"><a class="anchor" href="#middleware-repository-pullthrough"></a>Image Pullthrough</h5>
<div class="paragraph">
<p>If enabled, the registry will attempt to fetch requested blob from a remote
registry unless the blob exists locally. The remote candidates are calculated
from <strong>DockerImage</strong> entries stored in status of the
<a href="../../architecture/core_concepts/builds_and_image_streams.html#image-streams">image
stream</a>, a client pulls from. All the unique remote registry references in
such entries will be tried in turn until the blob is found. The blob, served
this way, will not be stored in the registry.</p>
</div>
<div class="paragraph">
<p>This feature is on by default. However, it can be disabled using a
<a href="#docker-registry-configuration-reference-middleware">configuration option</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="middleware-repository-acceptschema2"><a class="anchor" href="#middleware-repository-acceptschema2"></a>Manifest schema v2 support</h5>
<div class="paragraph">
<p>Each image has a manifest describing its blobs, instructions for running it
and additional metadata. The manifest is versioned which have different
structure and fields as it evolves over time. The same image can be represented
by multiple manifest versions. Each version will have different digest though.</p>
</div>
<div class="paragraph">
<p>The registry currently supports
<a href="https://github.com/docker/distribution/blob/master/docs/spec/manifest-v2-1.md#image-manifest-version-2-schema-1">manifest
v2 schema 1</a> (<strong>schema1</strong>) and
<a href="https://github.com/docker/distribution/blob/master/docs/spec/manifest-v2-2.md#image-manifest-version-2-schema-2">manifest
v2 schema 2</a> (<strong>schema2</strong>). The former is being obsoleted but will be supported
for an extended amount of time.</p>
</div>
<div class="paragraph">
<p>You should be wary of compatibility issues with various Docker clients:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Docker clients of version 1.9 or older support only <strong>schema1</strong>. Any manifest
this client pulls or pushes will be of this legacy schema.</p>
</li>
<li>
<p>Docker clients of version 1.10 support both <strong>schema1</strong> and <strong>schema2</strong>. And by default, it will
push the latter to the registry if it supports newer schema.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The registry, storing an image with <strong>schema1</strong> will always return it unchanged
to the client. <strong>Schema2</strong> will be transferred unchanged only to newer Docker
client. For the older one, it will be converted on-the-fly to <strong>schema1</strong>.</p>
</div>
<div class="paragraph">
<p>This has significant consequences. For example an image pushed to the registry
by a newer Docker client cannot be pulled by the older Docker by its digest.
That&#8217;s because the stored image&#8217;s manifest is of <strong>schema2</strong> and its digest can
be used to pull only this version of manifest.</p>
</div>
<div class="paragraph">
<p>For this reason, the registry is configured by default not to store <strong>schema2</strong>.
This ensures that any docker client will be able to pull from the registry any
image pushed there regardless of client&#8217;s version.</p>
</div>
<div class="paragraph">
<p>Once you&#8217;re confident that all the registry clients support <strong>schema2</strong>, you&#8217;ll
be safe to enable its support in the registry. See the
<a href="#docker-registry-configuration-reference-middleware">middleware
configuration reference</a> above for particular option.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="docker-registry-configuration-reference-reporting"><a class="anchor" href="#docker-registry-configuration-reference-reporting"></a>Reporting</h4>
<div class="paragraph">
<p>Reporting is unsupported.</p>
</div>
</div>
<div class="sect3">
<h4 id="docker-registry-configuration-reference-http"><a class="anchor" href="#docker-registry-configuration-reference-http"></a>HTTP</h4>
<div class="paragraph">
<p><a href="https://docs.docker.com/registry/configuration/#http">Upstream options</a> are
supported. <a href="#securing-the-registry">Learn how to alter these settings via
environment variables</a>. Only the <strong>tls</strong> section should be altered. For example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span style="color:#606">http</span>:
  <span style="color:#606">addr</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">:5000</span></span>
  <span style="color:#606">tls</span>:
    <span style="color:#606">certificate</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">/etc/secrets/registry.crt</span></span>
    <span style="color:#606">key</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">/etc/secrets/registry.key</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="docker-registry-configuration-reference-notifications"><a class="anchor" href="#docker-registry-configuration-reference-notifications"></a>Notifications</h4>
<div class="paragraph">
<p><a href="https://docs.docker.com/registry/configuration/#notifications">Upstream
options</a> are supported. The <a href="../../rest_api/index.html#rest-api-index">REST API Reference</a>
provides more comprehensive integration options.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span style="color:#606">notifications</span>:
  <span style="color:#606">endpoints</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: registry</span></span>
      <span style="color:#606">disabled</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false</span></span>
      <span style="color:#606">url</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">https://url:port/path</span></span>
      <span style="color:#606">headers</span>:
        <span style="color:#606">Accept</span>:
          - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">text/plain</span></span>
      <span style="color:#606">timeout</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">500</span></span>
      <span style="color:#606">threshold</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">5</span></span>
      <span style="color:#606">backoff</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1000</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="docker-registry-configuration-reference-redis"><a class="anchor" href="#docker-registry-configuration-reference-redis"></a>Redis</h4>
<div class="paragraph">
<p>Redis is not supported.</p>
</div>
</div>
<div class="sect3">
<h4 id="docker-registry-configuration-reference-health"><a class="anchor" href="#docker-registry-configuration-reference-health"></a>Health</h4>
<div class="paragraph">
<p><a href="https://docs.docker.com/registry/configuration/#health">Upstream options</a>
are supported. The registry deployment configuration provides an integrated
health check at <strong>/healthz</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="docker-registry-configuration-reference-proxy"><a class="anchor" href="#docker-registry-configuration-reference-proxy"></a>Proxy</h4>
<div class="paragraph">
<p>Proxy configuration should not be enabled. This functionality is provided by
the <a href="#docker-registry-configuration-reference-middleware">OpenShift Enterprise
repository middleware extension</a>, <strong>pullthrough: true</strong>.</p>
</div>
<div class="paragraph">
<p>end::registry-configuration-reference[]</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="whitelisting-docker-registries"><a class="anchor" href="#whitelisting-docker-registries"></a>Whitelisting Docker Registries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can specify a whitelist of docker registries, allowing you to curate a set
of images and templates that are available for download by OpenShift Enterprise
users. This curated set can be placed in one or more docker registries, and then
added to the whitelist. When using a whitelist, only the specified registries
are accessible within OpenShift Enterprise, and all other registries are denied
access by default.</p>
</div>
<div class="paragraph">
<p>To configure a whitelist:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Edit the <strong><em>/etc/sysconfig/docker</em></strong> file to block all registries:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BLOCK_REGISTRY='--block-registry=all'</pre>
</div>
</div>
<div class="paragraph">
<p>You may need to uncomment the <code><strong>BLOCK_REGISTRY</strong></code> line.</p>
</div>
</li>
<li>
<p>In the same file, add registries to which you want to allow access:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ADD_REGISTRY='--add-registry=&lt;registry1&gt; --add-registry=&lt;registry2&gt;'</pre>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 3. Allowing Access to Registries</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">ADD_REGISTRY='--add-registry=registry.access.redhat.com'</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This example would restrict access to images available on the
<a href="https://access.redhat.com/search/#/container-images">Red Hat Customer Portal</a>.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Once the whitelist is configured, if a user tries to pull from a docker registry
that is not on the whitelist, they will receive an error message stating that
this registry is not allowed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exposing-the-registry"><a class="anchor" href="#exposing-the-registry"></a>Exposing the Registry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To expose your internal registry externally, it is recommended that you run a
<a href="#securing-the-registry">secure registry</a>. To expose the registry you must
first have <a href="deploy_router.html#install-config-install-deploy-router">deployed a router</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#deploy-registry">Deploy the registry</a>.</p>
</li>
<li>
<p><a href="#securing-the-registry">Secure the registry</a>.</p>
</li>
<li>
<p><a href="deploy_router.html#install-config-install-deploy-router">Deploy a router</a>.</p>
</li>
<li>
<p>Create a
<a href="https://docs.openshift.org/latest/architecture/core_concepts/routes.html#secured-routes">passthrough</a>
route via the <code>oc create route passthrough</code> command,
specifying the registry as the route&#8217;s service.
By default, the name of the created route is the same as the service name.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get svc
NAME              CLUSTER_IP       EXTERNAL_IP   PORT(S)                 SELECTOR                  AGE
docker-registry   172.30.69.167    &lt;none&gt;        5000/TCP                docker-registry=default   4h
kubernetes        172.30.0.1       &lt;none&gt;        443/TCP,53/UDP,53/TCP   &lt;none&gt;                    4h
router            172.30.172.132   &lt;none&gt;        80/TCP                  router=router             4h

$ oc create route passthrough    \
    --service=docker-registry    \<i class="conum" data-value="1"></i><b>(1)</b>
    --hostname=&lt;host&gt;
route "docker-registry" created     <i class="conum" data-value="2"></i><b>(2)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the registry as the route&#8217;s service.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The route name is identical to the service name.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get route/docker-registry -o yaml
apiVersion: v1
kind: Route
metadata:
  name: docker-registry
spec:
  host: &lt;host&gt; <i class="conum" data-value="1"></i><b>(1)</b>
  to:
    kind: Service
    name: docker-registry <i class="conum" data-value="2"></i><b>(2)</b>
  tls:
    termination: passthrough <i class="conum" data-value="3"></i><b>(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The host for your route.  You must be able to resolve this name externally via DNS to the router&#8217;s IP address.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The service name for your registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify this route as a passthrough route.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Passthrough is currently the only type of route supported for exposing the
secure registry.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Next, you must trust the certificates being used for the registry on your host system.
The certificates referenced were created when you secured your registry.</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo mkdir -p /etc/docker/certs.d/&lt;host&gt;
$ sudo cp &lt;ca certificate file&gt; /etc/docker/certs.d/&lt;host&gt;
$ sudo systemctl restart docker</pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><a href="#access">Log in to the registry</a> using the information from securing the
registry. However, this time point to the host name used in the route rather
than your service IP. You should now be able to tag and push images using the
route host.</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get imagestreams -n test
NAME      DOCKER REPO   TAGS      UPDATED

$ docker pull busybox
$ docker tag busybox &lt;host&gt;/test/busybox
$ docker push &lt;host&gt;/test/busybox
The push refers to a repository [&lt;host&gt;/test/busybox] (len: 1)
8c2e06607696: Image already exists
6ce2e90b0bc7: Image successfully pushed
cf2616975b4a: Image successfully pushed
Digest: sha256:6c7e676d76921031532d7d9c0394d0da7c2906f4cb4c049904c4031147d8ca31

$ docker pull &lt;host&gt;/test/busybox
latest: Pulling from &lt;host&gt;/test/busybox
cf2616975b4a: Already exists
6ce2e90b0bc7: Already exists
8c2e06607696: Already exists
Digest: sha256:6c7e676d76921031532d7d9c0394d0da7c2906f4cb4c049904c4031147d8ca31
Status: Image is up to date for &lt;host&gt;/test/busybox:latest

$ oc get imagestreams -n test
NAME      DOCKER REPO                       TAGS      UPDATED
busybox   172.30.11.215:5000/test/busybox   latest    2 seconds ago</pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Your image streams will have the IP address and port of the registry service,
not the route name and port. See <code>oc get imagestreams</code> for details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the <code>&lt;host&gt;/test/busybox</code> example above, <code>test</code> refers to the project name.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-known-issues"><a class="anchor" href="#registry-known-issues"></a>Known Issues</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following are the known issues when deploying or using the integrated
registry.</p>
</div>
<div class="sect3">
<h4 id="known-issue-nfs-image-push-fails"><a class="anchor" href="#known-issue-nfs-image-push-fails"></a>Image Push Errors with Scaled Registry Using Shared NFS Volume</h4>
<div class="paragraph">
<p>When using a scaled registry with a shared NFS volume, you may see one of the
following errors during the push of an image:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>digest invalid: provided digest did not match uploaded content</code></p>
</li>
<li>
<p><code>blob upload unknown</code></p>
</li>
<li>
<p><code>blob upload invalid</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These errors are returned by an internal registry service when Docker attempts
to push the image. Its cause originates in the synchronization of file
attributes across nodes. Factors such as NFS client side caching, network
latency, and layer size can all contribute to potential errors that might occur
when pushing an image using the default round-robin load balancing
configuration.</p>
</div>
<div class="paragraph">
<p>You can perform the following steps to minimize the probability of such a
failure:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that the <code><strong>sessionAffinity</strong></code> of your <strong>docker-registry</strong> service is set
to <code>ClientIP</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get svc/docker-registry --template='{{.spec.sessionAffinity}}'</pre>
</div>
</div>
<div class="paragraph">
<p>This should return <code>ClientIP</code>, which is the default in recent OpenShift Enterprise
versions. If not, change it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get -o yaml svc/docker-registry | \
      sed 's/\(sessionAffinity:\s*\).*/\1ClientIP/' | \
      oc replace -f -</pre>
</div>
</div>
</li>
<li>
<p>Ensure that the NFS export line of your registry volume on your NFS server has
the <code>no_wdelay</code> options listed. See
<a href="../persistent_storage/persistent_storage_nfs.html#nfs-export-settings">Export
Settings</a> in the
<a href="../../install_config/persistent_storage/persistent_storage_nfs.html#install-config-persistent-storage-persistent-storage-nfs">Persistent
Storage Using NFS</a> topic for details.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="pull-of-internally-managed-image-fails-with-code-not-found-code-error"><a class="anchor" href="#pull-of-internally-managed-image-fails-with-code-not-found-code-error"></a>Pull of Internally Managed Image Fails with <code>not found</code> Error</h4>
<div class="paragraph">
<p>This error occurs when the pulled image is pushed to an image stream different
from the one it is being pulled from. This is caused by re-tagging a built image into an arbitrary image stream:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc tag srcimagestream:latest anyproject/pullimagestream:latest</pre>
</div>
</div>
<div class="paragraph">
<p>And subsequently pulling from it, using an image reference such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">internal.registry.url:5000/anyproject/pullimagestream:latest</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>During a manual Docker pull, this will produce a similar error:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">Error: image anyproject/pullimagestream:latest not found</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To prevent this, avoid the tagging of internally managed images completely, or
re-push the built image to the desired namespace
<a href="#access-pushing-and-pulling-images">manually</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="known-issue-s3-image-push-fails"><a class="anchor" href="#known-issue-s3-image-push-fails"></a>Image Push fails with <code>500 Internal Server Error</code> on S3 storage</h4>
<div class="paragraph">
<p>There are problems reported happening when the registry runs on S3 storage
back-end. Pushing to a Docker registry occasionally fails with the following
error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Received unexpected HTTP status: 500 Internal Server Error</pre>
</div>
</div>
<div class="paragraph">
<p>To debug this, you need to <a href="#viewing-logs">view the registry logs</a>. In there,
look for similar error messages occurring at the time of the failed push:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">time="2016-03-30T15:01:21.22287816-04:00" level=error msg="unknown error completing upload: driver.Error{DriverName:\"s3\", Enclosed:(*url.Error)(0xc20901cea0)}" http.request.method=PUT
...
time="2016-03-30T15:01:21.493067808-04:00" level=error msg="response completed with error" err.code=UNKNOWN err.detail="s3: Put https://s3.amazonaws.com/oso-tsi-docker/registry/docker/registry/v2/blobs/sha256/ab/abe5af443833d60cf672e2ac57589410dddec060ed725d3e676f1865af63d2e2/data: EOF" err.message="unknown error" http.request.method=PUT
...
time="2016-04-02T07:01:46.056520049-04:00" level=error msg="error putting into main store: s3: The request signature we calculated does not match the signature you provided. Check your key and signing method." http.request.method=PUT
atest</pre>
</div>
</div>
<div class="paragraph">
<p>If you see such errors, contact your Amazon S3 support. There may be a
problem in your region or with your particular bucket.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-whats-next"><a class="anchor" href="#registry-whats-next"></a>What&#8217;s Next?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After you have a registry deployed, you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../../install_config/configuring_authentication.html#install-config-configuring-authentication">Configure
authentication</a>; by default, authentication is set to
<a href="../../install_config/configuring_authentication.html#DenyAllPasswordIdentityProvider">Deny
All</a>.</p>
</li>
<li>
<p>Deploy a <a href="deploy_router.html#install-config-install-deploy-router">router</a>.</p>
</li>
</ul>
</div>
</div>
</div>
      </div>
    </div>
  </div>
  <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
    <footer class="footer-openshift">
  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-sm-4 col-md-3 logo">
        <a href="https://www.redhat.com/"></a>
      </div>
      <div class="col-xs-12 col-sm-4 col-md-6 text-center">
        <div class="row">
          <div class="col-xs-12 col-md-4">
            <a href="https://www.openshift.com/legal/privacy.html">
              Privacy Policy
            </a>
          </div>
          <div class="col-xs-12 col-md-4">
          <a href="https://www.openshift.com/legal/terms.html">
            Terms and Conditions
          </a>
          </div>
          <div class="col-xs-12 col-md-4">
          <a href="http://www.openshift.org/">
            Open Source
          </a>
          </div>
        </div>
      </div>
      <div class="col-xs-12 col-sm-4 col-md-3 text-right">
        <a id="built_with_asciibinder" href="http://asciibinder.org/">
          <img src="../../../scollier-test/_images/asciibinder_web_logo.svg" alt="AsciiBinder" />
        </a>
      </div>
    </div>
  </div>
</footer>
</body>
</html>